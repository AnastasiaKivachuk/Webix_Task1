<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Lesson 1</title>
    <script type="text/javascript" src="http://cdn.webix.com/edge/webix.js"></script>

    <link rel="stylesheet" type="text/css" href="http://cdn.webix.com/edge/webix.css">
    <!-- <script type="text/javascript" src="data/data.js"></script> -->
    <script type="text/javascript" src="data/users.js"></script>
    <script type="text/javascript" src="data/products.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <script type="text/javascript" charset="utf-8">


        var toolbar = {
            view: "toolbar",
            padding: {
                left: 10, right: 10
            },
            css: "webix_dark",
            cols: 
            [
                {
                view: "label",
                label: "My App",
                align: "left",

            },
            {
                view: "button",
                autowidth: true,
                label: "Profile",
                type: "icon",
                icon: "wxi-user",
                css: "webix_transparent",
                borderless: true,
                popup: {
                    view: "popup",
                    id: "my_popup",
                    body: {
                        view: "list",
                        id: "myMenulist",
                        scroll: false,
                        width: 200,
                        autoheight: true,
                        css: "sideGray",
                        data: ["Settings", "Log out"]
                    }
                }
            }
            ]
        };

        var dataTable = {
            view: "datatable",
            id: "mydata",
            hover: "hoverLine",
           // data: dataData,
            // template: "#id# #title# #year# #votes# #rating#",
            columns: 
            [
                { id: "rank", header: "", width: 50, css: 'grayColumn', sort: "int" },
                { id: "title", header: ["Film title", { content: "textFilter" }], width: 200, sort: "string", fillspace: true },
                { id: "year", header: ["Released", { content: "textFilter" }], width: 100, sort: "int" },
                { id: "votes", header: ["Votes", { content: "textFilter" }], width: 80, sort: "int" },
                { id: "rating", header: ["Rating", { content: "textFilter" }], width: 80, sort: "int" },
                { template: "<span class='webix_icon wxi-trash removeBtn'></span>" }
            ],
            autoConfig: true,
            scrollX: false,
            ulr: "data/data.js",
            // on: function removeBtn (e, id) {
            //                 webix.confirm({
            //                     text: "Do you still want to continue?"
            //                 }).then(
            //                     function () {
            //                         this.remove(id);
            //         return false;
            //                     },
            //                 );
            //             }
            onClick: {
                removeBtn: function (e, id) {
                    this.remove(id);
                    return false;
                }
            },
        };

        var form = {
            view: "form",
            id: "myform",
            width: 400,
            elements: [{
                template: "EDIT FILMS",
                type: "section"
            },
            {
                view: "text",
                label: "Title",
                name: "title",
                invalidMessage: "Please enter title"
            },
            {
                view: "text",
                label: "Year",
                name: "year",
                invalidMessage: "Please enter year between 1970 and current"
            },
            {
                view: "text",
                label: "Rating",
                name: "rating",
                invalidMessage: "Please enter rating (it can't be 0)"
            },
            {
                view: "text",
                label: "Votes",
                name: "votes",
                invalidMessage: "Please enter votes less than 100000"
            },
            {
                cols: 
                [
                    {
                        view: "button",
                        value: "Add new",
                        css: "webix_primary",
                        click: function () {
                            if ($$("myform").validate()) {
                                webix.message("validation is successful");
                                var item = $$("myform").getValues();
                                console.log(item);
                                $$("mydata").add(item);
                            }
                        }
                    },
                    {
                        view: "button",
                        value: "Clear",
                        click: function () {
                            webix.confirm({
                                text: "Do you still want to continue?"
                            }).then(
                                function clear_form() {
                                    $$('myform').clear();
                                    $$("myform").clearValidation();
                                },
                            );
                        }
                    }
                ],
            },
            {}
            ],
            rules: {
                title: webix.rules.isNotEmpty,
                year: function (value) {
                    return value >= 1970 && value <= (new Date()).getFullYear();
                },
                rating: function (value) {
                    return value != 0;
                },
                votes: function (value) {
                    return value < 100000;
                },
            },

        };



        var listUser = {
            view: "list",
            id: "mylistUser",
            dynamic: true,
            height: 400,
            template: "#name# from #country# <span class='webix_icon wxi-close removeUser'></span>",
            select: "multiselect",
            data: dataUser,
            onClick: {
                removeUser: function (e, id) {
                    this.remove(id);
                    return false;
                }
            },
        }
        var chartUser = {
            view: "chart",
            type: "bar",
            value: "#age#",
            xAxis: {
                template: "#age#",
                title: "Age",
            },
            barWidth: 35,
            radius: 0,
            yAxis: {
                start: 0,
                end: 100,
                step: 10,
                template: function (obj) {
                    return (obj % 20 ? "" : obj)
                }
            },
            data: dataUser,
        };

        var sortLine = {
            paddingY: 5,
            cols: 
            [
                {
                    view: "text",
                    id: "inputUser",
                },
                {
                    view: "button",
                    value: "Sort asc",
                    css: "webix_primary",
                    autowidth: true,
                    click: function () {
                        $$("mylistUser").sort("#name#", "asc", "string")
                    }
                },
                {
                    view: "button",
                    value: "Sort desc",
                    css: "webix_primary",
                    autowidth: true,
                    click: function () {
                        $$("mylistUser").sort("#name#", "desc", "string")
                    }

                },
            ]
        };


        var treeProduct = {
            view: "treetable",
            columns: 
            [
                { id: "id", header: "", css: { "text-align": "right" }, width: 50 },
                {
                    id: "title", header: "Title", width: 250,
                    template: "{common.treetable()} #title#"
                },
                { id: "price", header: "Price", width: 100}
            ],

            data: dataProduct,
            
        };

        var multiviewCells = {
            cells: 
            [
                { id: "Dashboard", cols: [dataTable, form] },
                { id: "Users", rows: [sortLine, listUser, chartUser] },
                { id: "Products", rows: [treeProduct] },
                { id: "Locations", template: "Admin  view" },

            ]
        };

        var main = {
            cols: 
            [
                {
                rows: [
                    {
                        view: "list",
                        id: "mylist",
                        scroll: false,
                        width: 200,
                        select: true,
                        css: "sideGray",
                        on: {
                            onAfterSelect: function (id) {
                                $$(id).show();
                            }
                        },
                        data: ["Dashboard", "Users", "Products", "Locations"],
                    },
                    {
                        template: "<div><span class='webix_icon wxi-check'></span>Connected</div>",
                        css: "greenbutton",
                        autoheight: true,
                    }
                ]
            },
            { view: "resizer" },
                multiviewCells
            ]
        };

        var footer = {
            view: "template",
            css: "footer",
            autoheight: true,
            template: "The software is provided by <a href=#>https://webix.com</a>. All rights reserved (c)",
            align: "center"
        };

        webix.ready(function () {
            webix.ui({
                id: "app",
                rows: [toolbar, main, footer]
            });
            $$("mylist").select("Dashboard");
        })

        

    </script>
</body>

</html>